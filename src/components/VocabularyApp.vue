<template>
    <div class="vocabulary-app" :class="{ 'dark-theme': isDarkTheme }">
        <nav class="nav-bar" style="top: 0;">
            <div class="nav-bar-content">
                <div class="tabs">
                <button 
                    v-for="tab in tabs"
                    :key="tab.id"
                    :class="{ active: currentTab === tab.id }"
                    @click="currentTab = tab.id"
                >
                    {{ tab.name }}
                </button>
                </div>
                <div class="controls">
                <div class="import-export-buttons">
                    <button class="import-export-btn">
                        <RouterLink to="/convert">Ê†ºÂºèËΩ¨Êç¢</RouterLink>
                    </button>
                    <ExportBtn :allWords="allWords" :masteredWords="masteredWords" :difficultWords="difficultWords"/>
                    <ImportBtn @import-all-data="handleImport"/>
                </div>
                <div class="sort-controls">
                    <CustomSelect
                        v-model="sortMethods[currentTab]"
                        :options="sortOptions"
                        placeholder="ÊéíÂ∫èÊñπÂºè"
                        @change="handleSort"
                    />
                
                    <button class="blur-toggle-btn" @click="toggleBlurAll" title="ÂàáÊç¢Ê®°Á≥äÁä∂ÊÄÅ">
                        {{ isCurrentTabMostlyBlurred ? 'Ê∏ÖÊô∞' : 'Ê®°Á≥ä' }}
                    </button>
                </div>
                <div class="search-control">
                    <input
                    v-model="searchQuery"
                    type="text"
                    placeholder="ÊêúÁ¥¢ÂçïËØç..."
                    class="search-input"
                    @keyup.enter="handleSearch"
                    />
                    <button class="search-btn" @click="handleSearch">ÊêúÁ¥¢</button>
                </div>
                <ThemeToggle />
                <!-- <transition name="fade">
                    <div class="word-count" v-if="$route.path === '/' && wordCount > 0">
                    üìö ÂΩìÂâçÊ†áÁ≠æÈ°µÂçïËØçÊï∞Ôºö{{ wordCount }}
                    </div>
                </transition> -->
                </div>
            </div>
        </nav>
        <div class="word-table">
            <div class="word-table-container">
                <!-- Ë°®Ê†ºÂ§¥ÈÉ®‰øùÊåÅÂõ∫ÂÆö -->
                <div class="table-header">
                    <div class="header-cell">ÂçïËØç</div>
                    <div class="header-cell">Èáä‰πâ</div>
                    <div class="header-cell">Âä©ËÆ∞</div>
                    <div class="header-cell">Êìç‰Ωú</div>
                </div>

                <!-- ËôöÊãüÊªöÂä®ÂÆπÂô® -->
                <RecycleScroller class="virtual-scroller" :items="currentWords" :item-size="60" key-field="id">
                    <!-- ÊØè‰∏™ÂçïËØçÈ°πÁöÑÊ®°Êùø -->
                    <template #default="{ item: word }">
                        <div class="word-row">
                            <div class="word-cell">{{ word.word }}</div>
                            <div class="meaning-cell" :class="{ 'blurred': word.isBlurred }" @click="toggleWordBlur(word)">
                                {{ word.meaning }}
                            </div>
                            <div class="note-cell">
                                <input type="text" v-model="word.note" placeholder="Ê∑ªÂä†Âä©ËÆ∞..." class="note-input">
                            </div>
                            <div class="action-cell">
                                <template v-if="currentTab === 'all'">
                                    <button @click="moveWord(word, 'mastered')" title="ÁßªÂà∞ÁÜüËÆ∞" class="action-btn"><span>‚ùå</span></button>
                                    <button @click="moveWord(word, 'multiMeaning')" title="ÁßªÂà∞Â§ö‰πâ" class="action-btn">üîÄ</button>
                                    <button @click="moveWord(word, 'difficult')" title="ÁßªÂà∞ÈöæËÆ∞" class="action-btn">‚òÖ</button>
                                </template>
                                <template v-else-if="currentTab === 'mastered'">
                                    <button @click="moveWord(word, 'difficult')" title="ÁßªÂà∞ÈöæËÆ∞" class="action-btn">‚òÖ</button>
                                    <button @click="moveWord(word, 'multiMeaning')" title="ÁßªÂà∞Â§ö‰πâ" class="action-btn">üîÄ</button>
                                    <button @click="moveWord(word, 'all')" title="ÁßªÂõûÂÖ®ÈÉ®" class="action-btn">‚Ü©</button>
                                </template>
                                <template v-else-if="currentTab === 'multiMeaning'">
                                    <button @click="moveWord(word, 'mastered')" title="ÁßªÂà∞ÁÜüËÆ∞" class="action-btn"><span>‚ùå</span></button>
                                    <button @click="moveWord(word, 'difficult')" title="ÁßªÂà∞ÈöæËÆ∞" class="action-btn">‚òÖ</button>
                                    <button @click="moveWord(word, 'all')" title="ÁßªÂõûÂÖ®ÈÉ®" class="action-btn">‚Ü©</button>
                                </template>
                                <template v-else>
                                    <button @click="moveWord(word, 'mastered')" title="ÁßªÂà∞ÁÜüËÆ∞" class="action-btn"><span>‚ùå</span></button>
                                    <button @click="moveWord(word, 'multiMeaning')" title="ÁßªÂà∞Â§ö‰πâ" class="action-btn">üîÄ</button>
                                    <button @click="moveWord(word, 'all')" title="ÁßªÂõûÂÖ®ÈÉ®" class="action-btn">‚Ü©</button>
                                </template>
                            </div>
                        </div>
                    </template>
                </RecycleScroller>
            </div>
        </div>
    </div>
</template>

<script setup>
import { ref, computed, watch, onMounted } from 'vue';
import { RecycleScroller } from 'vue-virtual-scroller';
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css';
import CustomSelect from './CustomSelect.vue';
import ThemeToggle from './ThemeToggle.vue';
import { RouterLink, RouterView, useRouter } from 'vue-router'
import ExportBtn from './ExportBtn.vue';
import ImportBtn from './ImportBtn.vue';
import { debounce } from 'lodash';
// import initialWords from "../../data.json"

// Âú® setup ‰∏≠ÂàõÂª∫Ë∑ØÁî±ÂÆû‰æã
const router = useRouter();  // ÂÖ≥ÈîÆÔºöÂÆö‰πâ router ÂèòÈáè


const props = defineProps({
  updateWordCount: {
    type: Function,
    required: true
  }
});

// Áä∂ÊÄÅÁÆ°ÁêÜ
const allWords = ref([]);
window.allWords = allWords;
const masteredWords = ref([]);
const multiMeaningWords = ref([]);
const difficultWords = ref([]);
const currentTab = ref('all');
const sortMethods = ref({
    all: 'import',
    mastered: 'addTime',
    multiMeaning: 'addTime',
    difficult: 'addTime'
});
const isDarkTheme = ref(false);
const searchQuery = ref('');

// Ê†áÁ≠æÈ°µÈÖçÁΩÆ
const tabs = [
    { id: 'all', name: 'ÂÖ®ÈÉ®' },
    { id: 'mastered', name: 'ÁÜüËÆ∞' },
    { id: 'multiMeaning', name: 'Â§ö‰πâ' },
    { id: 'difficult', name: 'ÈöæËÆ∞' }
];

// ÊéíÂ∫èÈÄâÈ°π
const sortOptions = [
    { value: 'alphabet', label: 'Â≠óÊØç' },
    { value: 'import', label: 'ID' },
    { value: 'addTime', label: 'Êó∂Èó¥' },
    { value: 'random', label: 'ÈöèÊú∫' }
];

// ‰ªéÂêéÁ´ØÂä†ËΩΩÊúÄÊñ∞Êï∞ÊçÆ1.0
const loadDataFromBackend = async () => {
  try {
    // Ë∞ÉÁî®FlaskÂêéÁ´ØAPI
    const response = await fetch('http://localhost:5000/api/words');
    
    if (!response.ok) {
      throw new Error(`Âä†ËΩΩÂ§±Ë¥•: ${response.statusText}`);
    }
    
    const data = await response.json();

    // ÂàùÂßãÂåñÊï∞ÊçÆÔºàÁ°Æ‰øùÁªìÊûÑÊ≠£Á°ÆÔºâ
    allWords.value = data.allWords || [];
    masteredWords.value = data.masteredWords || [];
    multiMeaningWords.value = data.multiMeaningWords || [];
    difficultWords.value = data.difficultWords || [];
    
    console.log('Êï∞ÊçÆÂä†ËΩΩÊàêÂäü');
  } catch (err) {
    console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', err);
    alert('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Âú®PyCharm‰∏≠ÂêØÂä®ÊúçÂä°Âô®ÔºÅ');
    // ÂèØÈÄâÔºöÂä†ËΩΩÂ§±Ë¥•Êó∂‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ
    allWords.value = [
    //   { id: 1, word: 'example', meaning: '‰æãÂ≠ê', isBlurred: false, note: '' }
    ];
  }
};

// ÁªÑ‰ª∂ÊåÇËΩΩÊó∂Âä†ËΩΩÊï∞ÊçÆ
onMounted(() => {
  loadDataFromBackend();
});

// ‰øùÂ≠òÊï∞ÊçÆÂà∞ÂêéÁ´Ø1.0
const saveToBackend = async () => {
  // Êî∂ÈõÜÂΩìÂâçÊâÄÊúâÁä∂ÊÄÅÊï∞ÊçÆ
  const state = {
    allWords: allWords.value,
    masteredWords: masteredWords.value,
    multiMeaningWords: multiMeaningWords.value,
    difficultWords: difficultWords.value,
    sortMethods: sortMethods.value
  };

  try {
    const response = await fetch('http://localhost:5000/api/words', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(state), // ËΩ¨Êç¢‰∏∫JSONÂ≠óÁ¨¶‰∏≤
    });

    if (!response.ok) {
      throw new Error(`‰øùÂ≠òÂ§±Ë¥•: ${response.statusText}`);
    }

    const result = await response.json();
    console.log('Êï∞ÊçÆ‰øùÂ≠òÊàêÂäü:', result.message);
  } catch (err) {
    console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', err);
  }
};

// Èò≤ÊäñÂ§ÑÁêÜÔºöÈÅøÂÖçÈ¢ëÁπÅÊìç‰ΩúÂØºËá¥Â§öÊ¨°ËØ∑Ê±ÇÔºà300msÂÜÖÂêàÂπ∂Ôºâ
const debouncedSave = debounce(saveToBackend, 1000);

// Ê∑ªÂä†Ê®°Á≥äÂàáÊç¢ÊåâÈíÆ
const toggleBlurAll = () => {
    let currentWords;
    switch (currentTab.value) {
        case 'mastered':
            currentWords = masteredWords.value;
            break;
        case 'multiMeaning':
            currentWords = multiMeaningWords.value;
            break;
        case 'difficult':
            currentWords = difficultWords.value;
            break;
        default:
            currentWords = allWords.value;
    }
    
    // Ëé∑ÂèñÂΩìÂâçÂ§ßÂ§öÊï∞ÂçïËØçÁöÑÊ®°Á≥äÁä∂ÊÄÅ
    const blurredCount = currentWords.filter(w => w.isBlurred).length;
    const shouldBlur = blurredCount <= currentWords.length / 2;
    
    // Ê†πÊçÆÂΩìÂâçÁä∂ÊÄÅËÆæÁΩÆÊâÄÊúâÂçïËØçÁöÑÊ®°Á≥äÁä∂ÊÄÅ
    currentWords.forEach(word => {
        word.isBlurred = shouldBlur;
    });
    
    debouncedSave();
};

// Áî®‰∫éÂº∫Âà∂ÈáçÊñ∞ËÆ°ÁÆóÈöèÊú∫ÊéíÂ∫èÁöÑÊó∂Èó¥Êà≥
const randomSeed = ref(Date.now());

// ËÆ°ÁÆóÂΩìÂâçÊ†áÁ≠æÈ°µ‰∏≠ÁöÑÂçïËØçÊòØÂê¶Â§ßÂ§öÊï∞Â§Ñ‰∫éÊ®°Á≥äÁä∂ÊÄÅ
const isCurrentTabMostlyBlurred = computed(() => {
    let words;
    switch (currentTab.value) {
        case 'mastered':
            words = masteredWords.value;
            break;
        case 'multiMeaning':
            words = multiMeaningWords.value;
            break;
        case 'difficult':
            words = difficultWords.value;
            break;
        default:
            words = allWords.value;
    }
    
    const blurredCount = words.filter(w => w.isBlurred).length;
    return blurredCount > words.length / 2;
});

// ËÆ°ÁÆóÂΩìÂâçÊòæÁ§∫ÁöÑÂçïËØçÂàóË°®
const currentWords = computed(() => {
    // Á°Æ‰øùÊâÄÊúâ‰æùËµñÁöÑÂìçÂ∫îÂºèÊï∞ÊçÆÈÉΩË¢´Ê≠£Á°ÆËøΩË∏™
    const tab = currentTab.value;
    const query = searchQuery.value.trim().toLowerCase();
    const sortMethod = sortMethods.value[tab];
    const seed = randomSeed.value;

    // Ê†πÊçÆÂΩìÂâçÊ†áÁ≠æÈ°µÈÄâÊã©ÂçïËØçÂàóË°®
    let words;
    switch (tab) {
        case 'mastered':
            words = [...masteredWords.value];
            break;
        case 'multiMeaning':
            words = [...multiMeaningWords.value];
            break;
        case 'difficult':
            words = [...difficultWords.value];
            break;
        default:
            words = [...allWords.value];
    }

    // Â∫îÁî®ÊêúÁ¥¢ËøáÊª§
    if (query) {
        words = words.filter(word => 
            word.word.toLowerCase().includes(query) || 
            (word.meaning && word.meaning.toLowerCase().includes(query))
        );
    }
    
    // Â∫îÁî®ÊéíÂ∫è
    switch (sortMethod) {
        case 'import':
            return words.sort((a, b) => a.id - b.id);
        case 'alphabet':
            return words.sort((a, b) => a.word.localeCompare(b.word));
        case 'addTime':
            // ÊåâÊ∑ªÂä†Êó∂Èó¥ÊéíÂ∫èÔºöÊúâÊó∂Èó¥Êà≥ÁöÑÂú®ÂâçÔºåÊåâÊó∂Èó¥Êà≥ÈôçÂ∫èÔºõÊ≤°ÊúâÊó∂Èó¥Êà≥ÁöÑÂú®ÂêéÔºåÊåâIDÊéíÂ∫è
            return words.sort((a, b) => {
                const aTime = a.addedToCategory || 0;
                const bTime = b.addedToCategory || 0;
                
                // Â¶ÇÊûúÈÉΩÊúâÊó∂Èó¥Êà≥ÔºåÊåâÊó∂Èó¥Êà≥ÈôçÂ∫èÔºàÊñ∞ÁöÑÂú®ÂâçÔºâ
                if (aTime && bTime) {
                    return bTime - aTime;
                }
                // Â¶ÇÊûúÂè™ÊúâaÊúâÊó∂Èó¥Êà≥ÔºåaÂú®Ââç
                if (aTime && !bTime) {
                    return -1;
                }
                // Â¶ÇÊûúÂè™ÊúâbÊúâÊó∂Èó¥Êà≥ÔºåbÂú®Ââç
                if (!aTime && bTime) {
                    return 1;
                }
                // Â¶ÇÊûúÈÉΩÊ≤°ÊúâÊó∂Èó¥Êà≥ÔºåÊåâIDÊéíÂ∫è
                return a.id - b.id;
            });
        case 'random':
            // ‰ΩøÁî®Fisher-YatesÊ¥óÁâåÁÆóÊ≥ïËøõË°åÈöèÊú∫ÊéíÂ∫è
            for (let i = words.length - 1; i > 0; i--) {
                const j = Math.floor((Math.random() * seed) % (i + 1));
                [words[i], words[j]] = [words[j], words[i]];
            }
            return words;
        default:
            return words;
    }
    
});

// ÂàáÊç¢Âçï‰∏™ÂçïËØçÁöÑÊ®°Á≥äÁä∂ÊÄÅ
const toggleWordBlur = (word) => {
    // Áõ¥Êé•ÂàáÊç¢ÂçïËØçÁöÑÊ®°Á≥äÁä∂ÊÄÅ
    word.isBlurred = !word.isBlurred;
    
    debouncedSave();
};

// ÁßªÂä®ÂçïËØçÂà∞‰∏çÂêåÊ†áÁ≠æÈ°µ
const moveWord = (word, target) => {
    const removeFromArray = (arr, id) => {
        const index = arr.findIndex(w => w.id === id);
        if (index !== -1) {
        return arr.splice(index, 1)[0];
        }
        return null;
    };

    let sourceArray;
    let targetArray;

    switch (currentTab.value) {
        case 'all':
            sourceArray = allWords.value;
            if (target === 'mastered') {
                targetArray = masteredWords.value;
            } else if (target === 'multiMeaning') {
                targetArray = multiMeaningWords.value;
            } else {
                targetArray = difficultWords.value;
            }
            break;
        case 'mastered':
            sourceArray = masteredWords.value;
            if (target === 'difficult') {
                targetArray = difficultWords.value;
            } else if (target === 'multiMeaning') {
                targetArray = multiMeaningWords.value;
            } else {
                targetArray = allWords.value;
            }
            break;
        case 'multiMeaning':
            sourceArray = multiMeaningWords.value;
            if (target === 'mastered') {
                targetArray = masteredWords.value;
            } else if (target === 'difficult') {
                targetArray = difficultWords.value;
            } else {
                targetArray = allWords.value;
            }
            break;
        case 'difficult':
            sourceArray = difficultWords.value;
            if (target === 'mastered') {
                targetArray = masteredWords.value;
            } else if (target === 'multiMeaning') {
                targetArray = multiMeaningWords.value;
            } else {
                targetArray = allWords.value;
            }
            break;
    }

    const movedWord = removeFromArray(sourceArray, word.id);
    if (movedWord) {
        const updatedWord = {
            ...movedWord,
            isBlurred: movedWord.isBlurred
        };
        
        // Â¶ÇÊûúÊòØ‰ªé"ÂÖ®ÈÉ®"ÁßªÂä®Âà∞ÂÖ∂‰ªñÂàÜÁ±ªÔºåÊ∑ªÂä†Êó∂Èó¥Êà≥
        if (currentTab.value === 'all' && target !== 'all') {
            updatedWord.addedToCategory = Date.now();
        }
        // Â¶ÇÊûúÊòØ‰ªéÂÖ∂‰ªñÂàÜÁ±ªÁßªÂõû"ÂÖ®ÈÉ®"ÔºåÊ∏ÖÈô§Êó∂Èó¥Êà≥
        else if (currentTab.value !== 'all' && target === 'all') {
            delete updatedWord.addedToCategory;
        }
        // Â¶ÇÊûúÊòØÂú®ÂàÜÁ±ª‰πãÈó¥ÁßªÂä®ÔºàÊØîÂ¶Ç‰ªéÁÜüËÆ∞ÁßªÂä®Âà∞ÈöæËÆ∞ÊàñÂ§ö‰πâÔºâÔºåÊõ¥Êñ∞Êó∂Èó¥Êà≥
        else if (currentTab.value !== 'all' && target !== 'all') {
            updatedWord.addedToCategory = Date.now();
        }
        
        // Ê†πÊçÆÊòØÂê¶ÊúâÊó∂Èó¥Êà≥ÂÜ≥ÂÆöÊèíÂÖ•‰ΩçÁΩÆ
        if (updatedWord.addedToCategory && target !== 'all') {
            // ÊúâÊó∂Èó¥Êà≥ÁöÑÊèíÂÖ•Âà∞ÂºÄÂ§¥ÔºàÊúÄÊñ∞ÁöÑÂú®ÊúÄ‰∏äÈù¢Ôºâ
            targetArray.unshift(updatedWord);
        } else {
            // Ê≤°ÊúâÊó∂Èó¥Êà≥ÁöÑÊ∑ªÂä†Âà∞Êú´Â∞æ
            targetArray.push(updatedWord);
        }
    }
    
    debouncedSave();
};

// Â§ÑÁêÜÊéíÂ∫èÂèòÂåñ
const handleSort = () => {
    // Â¶ÇÊûúÊòØÈöèÊú∫ÊéíÂ∫èÔºåÊõ¥Êñ∞ÈöèÊú∫ÁßçÂ≠ê
    if (sortMethods.value[currentTab.value] === 'random') {
        randomSeed.value = Date.now();
    }

    debouncedSave();
};

// ÁõëÂê¨ÂΩìÂâçÊ†áÁ≠æÈ°µÂçïËØçÊï∞ÈáèÂèòÂåñ
watch(
    currentWords,
    (newWords) => {
        // console.log('currentWords changed, new length:', newWords.length); // Ê∑ªÂä†Êó•Âøó
        if (props.updateWordCount) {
        props.updateWordCount(newWords.length);
        } else {
        //   console.warn('updateWordCount prop is not available'); // Ê∑ªÂä†Ë≠¶ÂëäÊó•Âøó
        }
    },
    { 
        immediate: true, // Á´ãÂç≥ÊâßË°å
        deep: true // Ê∑±Â∫¶ÁõëÂê¨
    }
);

// ÁõëÂê¨ÂçïËØçÊï∞ÁªÑÁöÑÊ∑±Â±ÇÂèòÂåñÔºàÂåÖÊã¨note‰øÆÊîπÔºâ
// ÊõøÊç¢ÂéüÊúâÁöÑwatchÔºåÂè™ÁõëÂê¨noteÂ≠óÊÆµÂèòÂåñ
watch(
  () => [
    // Âè™ÊèêÂèñÊâÄÊúâÂçïËØçÁöÑnoteÂ≠óÊÆµÁªÑÊàê‰æùËµñÊï∞ÁªÑ
    ...allWords.value.map(w => w.note),
    ...masteredWords.value.map(w => w.note),
    ...multiMeaningWords.value.map(w => w.note),
    ...difficultWords.value.map(w => w.note)
  ],
  () => {
    debouncedSave();
  },
  { deep: false } // Êó†ÈúÄÊ∑±Â±ÇÁõëÂê¨ÔºåÂõ†‰∏∫‰æùËµñÊï∞ÁªÑÂ∑≤Áõ¥Êé•ÂÖ≥ËÅînote
);

// ÂØºÂÖ•ÁªÑ‰ª∂Êõ¥Êñ∞Áà∂ÁªÑ‰ª∂Êï∞ÊçÆ
const handleImport = (data) => {
    allWords.value = data.allWords;
    masteredWords.value = data.masteredWords;
    multiMeaningWords.value = data.multiMeaningWords || [];
    difficultWords.value = data.difficultWords;
};

// // Â§ÑÁêÜÂ§áÊ≥®ËæìÂÖ•‰∫ã‰ª∂
// const handleNoteInput = (word) => {
//   // ÊâæÂà∞ÂçïËØçÂú®Êï∞ÁªÑ‰∏≠ÁöÑ‰ΩçÁΩÆÂπ∂Êõ¥Êñ∞ÔºàÁ°Æ‰øùÂìçÂ∫îÂºèÁîüÊïàÔºâ
//   const updateWordInArray = (array) => {
//     const index = array.findIndex(w => w.id === word.id);
//     if (index !== -1) {
//       array[index] = { ...word };  // Âº∫Âà∂Êõ¥Êñ∞ÂìçÂ∫îÂºèÊï∞ÊçÆ
//     }
//   };

//   // Ê£ÄÊü•ÂçïËØçÂ±û‰∫éÂì™‰∏™Êï∞ÁªÑÂπ∂Êõ¥Êñ∞
//   updateWordInArray(allWords.value);
//   updateWordInArray(masteredWords.value);
//   updateWordInArray(difficultWords.value);

//   // Ëß¶Âèë‰øùÂ≠ò
//   debouncedSave();
// };

</script>

<style>
/* Áé∞‰ª£ÊªöÂä®Êù°Ê†∑Âºè */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--page-bg-color);
}

::-webkit-scrollbar-thumb {
    background: var(--primary-light);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--button-text-color);
}
a {
    text-decoration: none;
    color: var(--button-text-color);
}
</style>

<style scoped>

.word-table-container {
  width: 100%;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  overflow: hidden;
}

.table-header {
  display: flex;
  background-color: var(--page-bg-color);
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 10;
  align-items: center;
  text-align: center;
  height: 40px;
  padding: 5px;
}

.header-cell {
  /* ËÆæÁΩÆflexÊØî‰æãÔºåÊÄªÂíå‰∏∫8Ôºà2+3+2+1Ôºâ */
  /* ÂçïËØçÂàóÂç†2‰ªΩ */
  &:nth-child(1) {
    flex: 1.5;
  }
  /* Èáä‰πâÂàóÂç†3‰ªΩÔºàÊúÄÂÆΩÔºåÂõ†‰∏∫ÂÜÖÂÆπÂèØËÉΩÊúÄÂ§öÔºâ */
  &:nth-child(2) {
    flex: 3.5;
  }
  /* Â§áÊ≥®ÂàóÂç†2‰ªΩ */
  &:nth-child(3) {
    flex: 3.5;
  }
  /* Êìç‰ΩúÂàóÂç†1.5‰ªΩÔºàÂ¢ûÂä†ÂÆΩÂ∫¶‰ª•ÈÄÇÂ∫î‰∏â‰∏™ÊåâÈíÆÔºâ */
  &:nth-child(4) {
    flex: 1.5;
  }
}

.header-cell, .word-cell, .meaning-cell, .note-cell, .action-cell {
  /* padding: 12px 16px; */
  box-sizing: border-box;
    /* flex: 1; */
}

.header-cell {
  font-weight: bold;
  border-right: 1px solid #e0e0e0;
}

.header-cell:last-child {
  border-right: none;
}

.virtual-scroller {
  height: 800px; /* Âõ∫ÂÆöÊªöÂä®Âå∫ÂüüÈ´òÂ∫¶ */
  width: 100%;
}


.word-row {
  display: flex;
  border: 1px solid var(--border-color);
  height: 60px; /* ‰∏éitem-size‰øùÊåÅ‰∏ÄËá¥ */
  align-items: center;
  text-align: center;
}

.word-cell {
    flex: 1.5;
}

.meaning-cell {
    flex: 3.5;
}

.note-cell {
    flex: 3.5;
}

.action-cell {
    flex: 1.5;
}


.word-row:last-child {
  border-bottom: none;
}

.blurred {
  color: transparent;
  text-shadow: 0 0 8px #888;
}

.blurred:hover {
  cursor: pointer;
}

.note-input {
  width: 100%;
  padding: 6px 8px;
  background-color: var(--button-bg-color);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  box-sizing: border-box;
  color: var(--button-text-color); 
  caret-color: var(--text-color); /* ËæìÂÖ•Ê°Ü‰∏≠ÂÖâÊ†áÈ¢úËâ≤ */
}

.note-input::placeholder {
  color: var(--text-color); /* ËæìÂÖ•Ê°Ü‰∏≠ÊèêÁ§∫ÊñáÊú¨È¢úËâ≤ */
}



.action-btn {
  margin: 0 4px;
  padding: 4px 8px;
  border: none;
  background: var(--button-bg-color);
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.action-btn:hover {
  background: #e0e0e0;
}

.empty-state {
  text-align: center;
  padding: 20px;
  color: #888;
}

span {
    font-size: 9.1px;
}

/* ÊéßÂà∂Âå∫ÂüüÊ†∑Âºè */
.controls {
    display: flex;
    align-items: center;
    gap: 12px;
}

.sort-controls {
    display: flex;
    gap: 8px;
    align-items: center;
}

.search-control {
    caret-color: var(--text-color);
}

.search-input::placeholder {
    color: var(--text-color);
}


/* Ê®°Á≥äÂàáÊç¢ÊåâÈíÆ */
.blur-toggle-btn {
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    background-color: var(--button-bg-color);
    color: var(--button-text-color);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 1.05rem;
    white-space: nowrap;
}

.blur-toggle-btn:hover {
    background-color: var(--primary-hover-color);
    color: #ffffff;
}

.vocabulary-app {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding-top: 65px;
    background-color: var(--page-bg-color);
}

.word-table {
    margin-top: 10px;
    background-color: var(--table-bg-color);
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Áé∞‰ª£ÁÆÄÁ∫¶ÂØºËà™Ê†è */
.nav-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-md) var(--space-xl);
    background: linear-gradient(
        to right,
        var(--nav-bg-color),
        color-mix(in srgb, var(--nav-bg-color), white 10%)
    );
    box-shadow: var(--shadow-md);
    border-bottom: 1px solid var(--border-color);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: all 0.3s ease;
    }

/* Áé∞‰ª£Âç°ÁâáÂºèÂçïËØçË°® */
.word-table {
    background-color: var(--table-bg-color);
    border-radius: 12px;
    border: 1px solid var(--border-color);
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 1;
}

.word-table:hover {
    box-shadow: var(--shadow-md);
}

/* Áé∞‰ª£ÊåâÈíÆÊ†∑Âºè */
button {
    background-color: var(--button-bg-color);
    color: var(--button-text-color);
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    font-size: 1.05rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

button:hover {
    background-color: var(--primary-hover-color);
    transform: translateY(-1px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
            0 2px 4px -2px rgba(0, 0, 0, 0.1);
    color: #ffffff;
}

/* Áé∞‰ª£ËæìÂÖ•Ê°Ü */
input, select {
    background-color: var(--button-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

input:focus, select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color), transparent 70%);
}

/* ÂØºËà™Ê†èÂÜÖÂÆπÂÆπÂô® */
.nav-bar-content {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
    flex-wrap: wrap;
    gap: 10px;
}

/* Áé∞‰ª£Ê†áÁ≠æÈ°µ */
.tabs {
    display: flex;
    gap: 8px;
    padding: 10px;
    background-color: var(--tab-bg-color);
    border-radius: 10px;
    font-size: 40px;
    flex-shrink: 0;
}

.tabs button {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    background-color: transparent;
    color: var(--text-light);
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    box-shadow: none;
    white-space: nowrap;
}

/* ÊøÄÊ¥ªÁä∂ÊÄÅÁöÑÊ†áÁ≠æÈ°µÊ†∑Âºè */
.tabs button.active {
    background-color: var(--primary-color, #007bff);
    color: white;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
    transform: translateY(-1px);
}

/* Ê†áÁ≠æÈ°µÊÇ¨ÊµÆÁä∂ÊÄÅ */
.tabs button:hover:not(.active) {
    background-color: color-mix(in srgb, var(--primary-color, #007bff), transparent 85%);
    color: var(--primary-color, #007bff);
}

.controls {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

.theme-toggle {
    padding: 8px;
    border: none;
    border-radius: 4px;
    background-color: transparent;
    cursor: pointer;
    font-size: 1.2em;
}

/* ÂàóÂÆΩËÆæÁΩÆ - 1:1:3:1 ÊØî‰æã */
th:nth-child(1), td:nth-child(1) { width: 15%; } /* ÂçïËØçÂàó */
th:nth-child(2), td:nth-child(2) { width: 35%; } /* Èáä‰πâÂàó */
th:nth-child(3), td:nth-child(3) { width: 40%; }    /* Â§áÊ≥®Âàó */
/* Êìç‰ΩúÂàóÊ†∑Âºè */
th:nth-child(4), td:nth-child(4) { 
    width: 10%;
    text-align: center;
}

/* Á°Æ‰øùÊåâÈíÆÁªÑÂ±Ö‰∏≠ */
td:nth-child(4) .actions {
    justify-content: center;
    margin: 0 auto;
}

th {
    background-color: var(--button-bg-color);
    color: var(--text-color);
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
}

td {
    padding: 10px;
    color: var(--text-color);
    border-bottom: 1px solid var(--border-color);
    transition: all 0.2s ease;
    text-align: center;
    background-color: var(--table-bg-color); /* Á°Æ‰øùËÉåÊôØËâ≤ */
}

/* Á°Æ‰øùÂ§áÊ≥®ËæìÂÖ•Ê°ÜÊñáÂ≠óÂèØËßÅ */
td input {
    color: var(--text-color);
}

/* Ë°åÊÇ¨ÊµÆÊïàÊûú */
    tr:hover td {
    background-color: color-mix(in srgb, var(--table-bg-color), var(--primary-color) 3%);
}

/* ÁæéÂåñÊìç‰ΩúÊåâÈíÆ */
.actions button {
    padding: 6px 12px;
    margin: 0 4px;
    border-radius: 6px;
    font-size: 1rem;
    color: var(--button-text-color);
    background-color: transparent;
    border: 1px solid var(--border-color);
}

.actions button:hover {
    color: var(--primary-color);
    border-color: var(--primary-color);
    background-color: color-mix(in srgb, var(--primary-color), transparent 90%);
}

/* Â§áÊ≥®ËæìÂÖ•Ê°ÜÊ†∑Âºè */
td input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background-color: var(--input-bg-color);
    color: var(--text-color);
    font-size: 0.875rem;
    transition: all 0.2s ease;
}

td input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary-color), transparent 90%);
}
/* Ê®°Á≥äÊïàÊûú‰ºòÂåñ */
.blurred {
    filter: blur(5px);  /* ÂáèÂ∞èÊ®°Á≥äÂçäÂæÑ */
    cursor: pointer;
    transition: filter 0.1s ease;
    user-select: none;
}

/* ‰∏ãÊãâËèúÂçïÁæéÂåñ */
.custom-select {
    position: relative;
    min-width: 80px;
}

td input {
    width: 100%;
    padding: 6px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-color);
}

.actions {
    justify-content: center;
    gap: 8px;
    width: 100%;
}

.actions button {
    padding: 4px 8px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background-color: var(--button-bg-color);
    color: var(--text-color);
}

.import-export-buttons {
    display: flex;
    gap: 8px;
}

.blurred {
    filter: blur(5px);
    transition: filter 0.3s;
}

/* ÂØºËà™Ê†èÊ†∑Âºè‰ºòÂåñ */
.nav-bar {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 2px 8px var(--nav-shadow-color);
    transition: background-color 0.3s, box-shadow 0.3s;
}

.search-btn{
    margin-left: 10px;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° - Â∞èÂ±èÂπï‰ºòÂåñ */
@media (max-width: 1024px) {
    .nav-bar-content {
        flex-direction: column;
        gap: 15px;
        padding: 15px 10px;
    }
    
    .tabs {
        order: 1;
        width: 100%;
        justify-content: center;
    }
    
    .controls {
        order: 2;
        width: 100%;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .vocabulary-app {
        padding-top: 120px; /* Â¢ûÂä†È°∂ÈÉ®Èó¥Ë∑ùÈÄÇÂ∫îÊõ¥È´òÁöÑÂØºËà™Ê†è */
    }
}

@media (max-width: 768px) {
    .nav-bar-content {
        padding: 10px 5px;
    }
    
    .tabs button {
        padding: 8px 12px;
        font-size: 0.9rem;
    }
    
    .controls {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    
    .import-export-buttons,
    .sort-controls,
    .search-control {
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .vocabulary-app {
        padding-top: 160px; /* Ëøõ‰∏ÄÊ≠•Â¢ûÂä†È°∂ÈÉ®Èó¥Ë∑ù */
        padding-left: 10px;
        padding-right: 10px;
    }
    
    .word-table-container {
        overflow-x: auto; /* Ê∑ªÂä†Ê∞¥Âπ≥ÊªöÂä® */
        min-width: 600px; /* ËÆæÁΩÆÊúÄÂ∞èÂÆΩÂ∫¶ */
    }
    
    .action-btn {
        margin: 0 1px;
        padding: 2px 4px;
        font-size: 0.8rem;
    }
    
    .note-input {
        padding: 4px 6px;
        font-size: 0.8rem;
    }
}

@media (max-width: 480px) {
    .tabs {
        gap: 4px;
        padding: 8px;
    }
    
    .tabs button {
        padding: 6px 8px;
        font-size: 0.8rem;
    }
    
    .action-btn {
        margin: 0;
        padding: 2px 3px;
        font-size: 0.7rem;
    }
    
    .word-row {
        height: 50px;
    }
    
    .virtual-scroller {
        height: 600px;
    }
    
    .vocabulary-app {
        padding-top: 180px;
    }
}
</style>
